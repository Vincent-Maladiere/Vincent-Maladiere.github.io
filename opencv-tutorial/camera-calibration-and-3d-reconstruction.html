<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Camera calibration and 3D Reconstruction – Nextra</title><meta name="robots" content="index,follow"/><meta property="og:title" content="Camera calibration and 3D Reconstruction – Nextra"/><meta name="theme-color" content="#111" media="(prefers-color-scheme: dark)"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-primary-saturation: 100%;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
          --nextra-primary-saturation: 100%;
        }
      </style><meta name="msapplication-TileColor" content="#fff"/><meta http-equiv="Content-Language" content="en"/><meta name="description" content="Nextra: the next docs builder"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@shuding_"/><meta property="og:title" content="Nextra: the next docs builder"/><meta property="og:description" content="Nextra: the next docs builder"/><meta name="apple-mobile-web-app-title" content="Nextra"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/media/2b753e56cc9cd730-s.p.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/6a8ba8707d180031-s.p.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/35d328148735ad9b-s.p.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/e687665822bfc06c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e687665822bfc06c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7acdf249f868d277.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7acdf249f868d277.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-e81585bb9a6b8f4d.js" defer=""></script><script src="/_next/static/chunks/framework-0995a3e8436ddc4f.js" defer=""></script><script src="/_next/static/chunks/main-063a3325800c4ac4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fd0e6a9249fe2bdb.js" defer=""></script><script src="/_next/static/chunks/8247-006705128f44e93a.js" defer=""></script><script src="/_next/static/chunks/4537-8b7c0592cdb72347.js" defer=""></script><script src="/_next/static/chunks/pages/opencv-tutorial/camera-calibration-and-3d-reconstruction-cef7b2c74dcfbbbd.js" defer=""></script><script src="/_next/static/_hxuzv8OXSuUBok_Sbmau/_buildManifest.js" defer=""></script><script src="/_next/static/_hxuzv8OXSuUBok_Sbmau/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__className_de6e4f"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent print:nx-hidden"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/"><span>Vincent Maladiere</span></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-text-gray-600 hover:nx-text-gray-800 dark:nx-text-gray-400 dark:hover:nx-text-gray-200" aria-current="false" href="/proba-ml/home"><span class="nx-absolute nx-inset-x-0 nx-text-center">Proba ML</span><span class="nx-invisible nx-font-medium">Proba ML</span></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-text-gray-600 hover:nx-text-gray-800 dark:nx-text-gray-400 dark:hover:nx-text-gray-200" aria-current="false" href="/apply-2022/home"><span class="nx-absolute nx-inset-x-0 nx-text-center">Apply Conf 2022</span><span class="nx-invisible nx-font-medium">Apply Conf 2022</span></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-text-gray-600 hover:nx-text-gray-800 dark:nx-text-gray-400 dark:hover:nx-text-gray-200" aria-current="false" href="/contributing-scikit-learn/home"><span class="nx-absolute nx-inset-x-0 nx-text-center">Contributing to scikit-learn</span><span class="nx-invisible nx-font-medium">Contributing to scikit-learn</span></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-font-medium nx-subpixel-antialiased" aria-current="true" href="/opencv-tutorial/home"><span class="nx-absolute nx-inset-x-0 nx-text-center">OpenCV Tutorial</span><span class="nx-invisible nx-font-medium">OpenCV Tutorial</span></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-text-gray-600 hover:nx-text-gray-800 dark:nx-text-gray-400 dark:hover:nx-text-gray-200" aria-current="false" href="/about"><span class="nx-absolute nx-inset-x-0 nx-text-center">About</span><span class="nx-invisible nx-font-medium">About</span></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-font-medium nx-subpixel-antialiased" aria-current="true" href="mailto:maladiere.vincent@gmail.com"><span class="nx-absolute nx-inset-x-0 nx-text-center">Contact</span><span class="nx-invisible nx-font-medium">Contact</span></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-shrink-0 motion-reduce:nx-transform-none nx-transform-gpu nx-transition-all nx-ease-in-out print:nx-hidden md:nx-w-64 md:nx-sticky md:nx-self-start max-md:[transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nx-overflow-y-auto nx-overflow-x-hidden nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-var(--nextra-menu-height))] nextra-scrollbar"><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100"><ul class="nx-flex nx-flex-col nx-gap-1 nextra-menu-desktop max-md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/home">Home</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/image-processing">1. Image Processing</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/video-io">2. Video I/O</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/2d-features-framework">3. 2d features framework</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/opencv-tutorial/camera-calibration-and-3d-reconstruction">4. Camera Calibration and 3d reconstruction</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/video-analysis">5. Video Analysis</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/object-detection">6. Object Detection</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/machine-learning">7. Machine Learning</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/opencv-tutorial/core-module">8. Core Module</a></li></ul></div></div></div><div class="nx-sticky nx-bottom-0 nx-bg-white dark:nx-bg-dark nx-mx-4 nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none nx-border-t" data-toggle-animation="off"><div class="nx-grow nx-flex nx-flex-col"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:R2njcm:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block print:nx-hidden nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-6 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#camera-calibration" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Camera calibration</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#theory" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Theory</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#calibration-process" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Calibration process</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#focus-on-perspective-n-points-used-by-calibratecamera" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Focus on Perspective n Points (used by calibrateCamera)</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#epipolar-geometry" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Epipolar Geometry</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#depthmap" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Depthmap</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#qa" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Q&amp;A</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#full-api-documentation" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Full API Documentation</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#consistent-video-depth-estimation" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Consistent video depth estimation</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pose-estimation-using-opencv" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pose Estimation using OpenCV</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#1-model-registration" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">1. Model registration</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#2-model-detection" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">2. Model detection</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pose-estimation-using-caffe" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pose estimation using Caffe</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pose-estimation-using-mediapipe" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pose estimation using MediaPipe</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/Vincent-Maladiere/vincent-maladiere.github.io/issues/new?title=Feedback%20for%20%E2%80%9CCamera%20calibration%20and%203D%20Reconstruction%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give us feedback →<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/Vincent-Maladiere/vincent-maladiere.github.io/blob/master/pages/opencv-tutorial/camera-calibration-and-3d-reconstruction.md">Edit this page</a></div></div></nav><div id="reach-skip-nav"></div><article class="nx-w-full nx-break-words nextra-content nx-flex nx-min-h-[calc(100vh-var(--nextra-navbar-height))] nx-min-w-0 nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-6xl nx-px-6 nx-pt-4 md:nx-px-12"><div class="nextra-breadcrumb nx-mt-1.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 dark:nx-text-gray-400 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis" title="OpenCV Tutorial">OpenCV Tutorial</div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-100 contrast-more:dark:nx-text-current" title="4. Camera Calibration and 3d reconstruction">4. Camera Calibration and 3d reconstruction</div></div><h1 class="nx-mt-2 nx-text-4xl nx-font-bold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100">Camera calibration and 3D Reconstruction</h1>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/4.5.0/d6/d55/tutorial_table_of_content_calib3d.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/4.5.0/d6/d55/tutorial_table_of_content_calib3d.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Camera calibration allows you to use two cameras to perform depth estimation through epipolar geometry. Its implementation and practical usage is still quite hacky, so you might prefer using a builtin stereo camera directly instead of a DIY version.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Also, OpenCV has its takes on Pose estimation, but its usage is also quite tedious.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Understanding theory is the main goal of this section.</p>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Camera calibration<a href="#camera-calibration" id="camera-calibration" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Theory<a href="#theory" id="theory" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/3.4.15/dc/dbb/tutorial_py_calibration.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/3.4.15/dc/dbb/tutorial_py_calibration.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Calibrate both cameras once, and store calibration parameters for depth estimation. If the geometry between cameras change, you need to perform calibration again.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">2 kinds of parameters:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">internal: focal length, optical center, radial distortion coefficients of the lens</li>
<li class="nx-my-2">external: orientation (rotation + translation) of camera wrt some world coordinates system</li>
</ol>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-31 at 18.44.10.png" loading="lazy" width="1336" height="808" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 200&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAABlBMVEX//v79+PV8sBAOAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAFklEQVR4nGNgYGBkZAABKIUOEMKMjAAA3wAJ6tFl7QAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-31_at_18.44.10.64e65393.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Coordinates linked by</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Y</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Z</mi><mi>c</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>R</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Y</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Z</mi><mi>w</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>+</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">\begin{bmatrix} X_c \\ Y_c \\ Z_c \end{bmatrix}=R\begin{bmatrix} X_w \\ Y_w \\ Z_w \end{bmatrix}+t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">this can also be expressed as</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Y</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Z</mi><mi>c</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mo stretchy="false">[</mo><mi>R</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo stretchy="false">]</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Y</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Z</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} X_c \\ Y_c \\ Z_c\end{bmatrix} = [R|t] \begin{bmatrix} X_w \\ Y_w \\ Z_w \\ 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.65em"><span class="pstrut" style="height:6.8em"></span><span style="width:0.667em;height:4.800em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M403 1759 V84 H666 V0 H319 V1759 v1200 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v1200 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.65em"><span class="pstrut" style="height:6.8em"></span><span style="width:0.667em;height:4.800em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M347 1759 V0 H0 V84 H263 V1759 v1200 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v1200 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span></span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The 3×1 translation vector is appended as a column at the end of the 3×3 rotation matrix to obtain a 3×4 matrix called the <strong>Extrinsic Matrix</strong>.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Homogeneous coordinates</strong></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">In homogenous coordinate <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo separator="true">,</mo><mi>Y</mi><mo separator="true">,</mo><mi>Z</mi><mo separator="true">,</mo><mi>W</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X,Y,Z,W)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mclose">)</span></span></span></span> is the same as the point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mi mathvariant="normal">/</mi><mi>W</mi><mo separator="true">,</mo><mi>Y</mi><mi mathvariant="normal">/</mi><mi>W</mi><mo separator="true">,</mo><mi>Z</mi><mi mathvariant="normal">/</mi><mi>W</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X/W,Y/W,Z/W)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mclose">)</span></span></span></span> in cartesian coordinates</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">It allow us to represent infinite quantities using finite numbers, when <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">W=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-01 at 10.20.30.png" loading="lazy" width="1390" height="872" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 200&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAAD1BMVEX////7+vr69fTt7e3h4eej5NOEAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAI0lEQVR4nCWKwQkAMBCDoun+M5dwvkQMwQzFMoO+a2n12oYPA8cAKywvesYAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-01_at_10.20.30.f665544f.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Projection of a P point:</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>=</mo><msub><mi>X</mi><mi>c</mi></msub><mfrac><mi>f</mi><msub><mi>Z</mi><mi>c</mi></msub></mfrac><mspace linebreak="newline"></mspace><mi>v</mi><mo>=</mo><msub><mi>Y</mi><mi>c</mi></msub><mfrac><mi>f</mi><msub><mi>Z</mi><mi>c</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">u=X_c\frac{f}{Z_c} \\
v=Y_c\frac{f}{Z_c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.3773em;vertical-align:-0.4451em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.4461em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.3773em;vertical-align:-0.4451em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.4461em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">However, pixels in image sensor may not be square, so we distinguish <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">f_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">f_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> (usually the same though)</li>
<li class="nx-my-2">Optical center may not match the center of the image coordinate system, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">c_x, c_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></li>
<li class="nx-my-2"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.05556em">γ</span></span></span></span> is the skew between axis (usually 0)</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>The intrinsic matrix K</strong> is</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>v</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>f</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>γ</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>f</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Y</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Z</mi><mi>c</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} u&#x27; \\v&#x27;\\w&#x27;\end{bmatrix} = \begin{bmatrix} f_x &amp; \gamma &amp;c_x \\ 0 &amp; f_y  &amp; c_y \\ 0 &amp; 0 &amp; 1 \end{bmatrix}
\begin{bmatrix} X_c \\ Y_c \\ Z_c \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em">γ</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mfrac><mi>u</mi><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mfrac><mspace linebreak="newline"></mspace><msup><mi>v</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mfrac><mi>v</mi><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mfrac></mrow><annotation encoding="application/x-tex">u&#x27; = \frac{u}{w&#x27;} \\ v&#x27; = \frac{v}{w&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0404em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em"><span style="top:-2.786em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7519em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0404em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em"><span style="top:-2.786em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Goal of camera calibration: find <strong>R</strong>, <strong>t</strong> and <strong>K</strong></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>v</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>K</mi><mi mathvariant="normal">.</mi><mi>R</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>X</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Y</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>Z</mi><mi>w</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} u&#x27; \\ v&#x27; \\ w&#x27; \end{bmatrix}= K.R|t \begin{bmatrix} X_w \\ Y_w \\ Z_w \\ 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.667em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em"></span><span class="mord mathnormal" style="margin-right:0.07153em">K</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.65em"><span class="pstrut" style="height:6.8em"></span><span style="width:0.667em;height:4.800em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M403 1759 V84 H666 V0 H319 V1759 v1200 v1759 h347 v-84 H403z M403 1759 V0 H319 V1759 v1200 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.65em"><span class="pstrut" style="height:6.8em"></span><span style="width:0.667em;height:4.800em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M347 1759 V0 H0 V84 H263 V1759 v1200 v1759 H0 v84 H347z M347 1759 V0 H263 V1759 v1200 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span></span></span></span></span></p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Calibration process<a href="#calibration-process" id="calibration-process" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-01 at 10.36.38.png" loading="lazy" width="1066" height="894" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 280&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAMAAAACh/xsAAAAIVBMVEWqw++Wtu2eu+23zfKzyfC+0vPZ3eTM2/aKru32+v/k6O9ZxZGZAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAMUlEQVR4nB3KyREAIAgEsL1AtP+CHc072Ke7+2xkSM4QK06cwsJnlCBJQFGkiHfsSl0eCQDJXXE0NgAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-01_at_10.36.38.43159622.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Step 1: define real world coords</strong></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-01 at 10.43.38.png" loading="lazy" width="970" height="726" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 240&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAMFBMVEWPjIp6d3Jsa2leYGBkZmSdnZuFh4eclZFYWVqRlJSzv7t+fnpQT0+/0Muep6bNycs2L9THAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAMklEQVR4nBXGxREAIBAEsD03pP9uGfIKdKz37gMKwMwuKDhVtH+WZB4QeIlKgcdR5f4AIR4BKIQAPw8AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-01_at_10.43.38.bb898c13.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The world coordinates is attached to the checkerboard. Since all the corner lie on a plan, we can arbitrarily choose <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>w</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Z_w=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span> for each point</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Since corners are equally spaced, the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>X</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>Y</mi><mi>w</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X_w,Y_w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> of each point can be found easily from the chosen origin.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Step 2: capture multiple images of the checkerboard from different viewpoints</strong></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="calibration-patterns.gif" loading="lazy" width="400" height="300" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/calibration-patterns.950a0a5e.gif"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Step 3: Find 2D coordinates of checkerboard</strong></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We now have multiple images of the checkerboard. We also know the 3D location of points on the checkerboard in the world coordinates.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">3.a. Find checkerboard corners</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">#retval, corners = cv2.findChessboardCorners(image, patternSize, flags)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">ret</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> corners </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">findChessboardCorners</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    gray,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    (</span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)">),</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    cv2.CALIB_CB_ADAPTIVE_THRESH </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-punctuation)"> cv2.CALIB_CB_FAST_CHECK </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-punctuation)"> cv2.CALIB_CB_NORMALIZE_IMAGE</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">3.b. Refine checkerboard corners</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Takes in the original image, and the location of corners, and looks for the best corner location inside a small neighborhood of the original location.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The algorithm is iterative in nature and therefore we need to specify the termination criteria</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">#cv2.cornerSubPix(image, corners, winSize, zeroZone, criteria)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">criteria </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">TERM_CRITERIA_EPS </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">TERM_CRITERIA_MAX_ITER</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">30</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.001</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">corners2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">cornerSubPix</span><span style="color:var(--shiki-token-punctuation)">(gray, corners, (</span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">), (</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">), criteria)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2022-01-12 at 09.21.19.png" loading="lazy" width="854" height="922" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 280 320&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAMAAAAC2hU0AAAAPFBMVEWNjI2CjJRoaGmUh4WtrKyAg4+Tk5eKmISDg4OanJp7e3uXlplWVlaekYKhoZ+emoZ/l5GZnJC4t7idk458oBD/AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAOUlEQVR4nAXBBwLAIAgAsUNQhlo7/v/XJlTaawmtvifHYLH9lkHodukXqcelG6HufU4ogkhstYD2AzayAYX3EBy5AAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2022-01-12_at_09.21.19.246595a3.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Step 4: Calibrate camera</strong></p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">objp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">zeros</span><span style="color:var(--shiki-token-punctuation)">((</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, CHECKERBOARD[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">] </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)"> CHECKERBOARD[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">], </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">), np.float32)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">objp</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,:,:</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">]</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">mgrid</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-color-text)">CHECKERBOARD</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">],</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-color-text)">CHECKERBOARD</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">]].</span><span style="color:var(--shiki-color-text)">T</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">objectPoints </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> [objp]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">imagePoints </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> [corners2]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">retval</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> cameraMatrix</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> distCoeffs</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> rvecs</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> tvecs </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">calibrateCamera</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    objectPoints, imagePoints, gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">], </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">What <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">calibrateCamera</code> performs:</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Computes the linear intrinsic parameters and considers the non-linear ones to zero.</li>
<li class="nx-my-2">Estimates the initial camera pose (extrinsics) in function of the approximated intrinsics. This is done using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">cv::solvePnP(...)</code>.</li>
<li class="nx-my-2">Performs the Levenberg-Marquardt optimization algorithm to minimize the re-projection error between the detected 2D image points and 2D projections of the 3D object points. This is done using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">cv::projectPoints(...)</code>.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Step 5: Undistortion</strong></p>
<details class="nx-my-4 nx-rounded nx-border nx-border-gray-200 nx-bg-white nx-p-2 nx-shadow-sm first:nx-mt-0 dark:nx-border-neutral-800 dark:nx-bg-neutral-900"><summary class="nx-flex nx-items-center nx-cursor-pointer nx-list-none nx-p-1 nx-transition-colors hover:nx-bg-gray-100 dark:hover:nx-bg-neutral-800 before:nx-mr-1 before:nx-inline-block before:nx-transition-transform before:nx-content-[&#x27;&#x27;] dark:before:nx-invert before:nx-shrink-0 rtl:before:nx-rotate-180 [[data-expanded]&gt;&amp;]:before:nx-rotate-90">Motivation</summary><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none" style="height:0"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-0">
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Radial factor</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">For an undistorted pixel point at (x,y) coordinates, its position on the distorted image will be (x_distorted, y_distorted)</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The presence of the radial distortion manifests in form of the &quot;barrel&quot; or &quot;fish-eye&quot; effect.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><mi>x</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><msup><mi>r</mi><mn>2</mn></msup><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><msup><mi>r</mi><mn>4</mn></msup><mo>+</mo><msub><mi>k</mi><mn>3</mn></msub><msup><mi>r</mi><mn>6</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_{distorted}=x(1+k_1r^2+k_2r^4+k_3r^6)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">or</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9641em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9641em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><mi>y</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><msup><mi>r</mi><mn>2</mn></msup><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><msup><mi>r</mi><mn>4</mn></msup><mo>+</mo><msub><mi>k</mi><mn>3</mn></msub><msup><mi>r</mi><mn>6</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y_{distorted}=y(1+k_1r^2+k_2r^4+k_3r^6)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">or</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9641em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9641em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Tangent factor</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Tangential distortion occurs because the image taking lenses are not perfectly parallel to the imaging plane</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><mi>x</mi><mo>+</mo><mo stretchy="false">[</mo><mn>2</mn><msub><mi>p</mi><mn>1</mn></msub><mi>x</mi><mi>y</mi><mo>+</mo><msub><mi>p</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msup><mi>r</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x_{distorted}=x+[2p_1xy+p_2(r^2+2x^2)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">or</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)]</span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><mi>y</mi><mo>+</mo><mo stretchy="false">[</mo><msub><mi>p</mi><mn>1</mn></msub><mo stretchy="false">(</mo><msup><mi>r</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><msup><mi>y</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><msub><mi>p</mi><mn>2</mn></msub><mi>x</mi><mi>y</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">y_{distorted}=y+[p_1(r^2+2y^2)+2p_2xy]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">or</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">]</span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>c</mi><mi>o</mi><mi>e</mi><mi>f</mi><mi>f</mi><mi>i</mi><mi>c</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>p</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>p</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">distortion\_coefficients=(k_1,k_2,p_1,p_2,k_3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord" style="margin-right:0.02778em">_</span><span class="mord mathnormal">coe</span><span class="mord mathnormal" style="margin-right:0.10764em">ff</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now for the unit conversion we use the following formula:</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-23 at 11.01.25.png" loading="lazy" width="406" height="180" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 160&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAADFBMVEXw8PDn5+f4+Pjc3NwdggysAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAIElEQVR4nCXJwQkAMBADIJPsv/NR+hNEWyGLbpH58E4cAvYAKOetvGQAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-23_at_11.01.25.63c90b8c.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>f</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">f_x,f_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> are camera focal lengths and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">c_x,c_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> are the optical centers expressed in pixels coordinates</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Undistort</p>
</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-23 at 14.52.26.png" loading="lazy" width="1060" height="750" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 240&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAADFBMVEX+/v719fXw8PDp6ek7UNXsAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAJElEQVR4nEXJwQkAMAzDQFvaf+dCCKleB0pppg8PAjRIK4ZdDwTWADWs4D90AAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-23_at_14.52.26.cab3c380.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-23 at 11.00.06.png" loading="lazy" width="1956" height="802" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 120&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAADFBMVEX29fbu7u78/P3j4+MwwiyiAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAHElEQVR4nGNgYGBkZAADRmZmRjCbkZGBiYmJCQAA9gAXlJfsqQAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-23_at_11.00.06.c2fc89fd.png"/></p>
</div></div></details>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">getOptimalNewCameraMatrix</code> to refine the intrinsic matrix based on a scaling parameter 0 &lt; alpha &lt; 1</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">If alpha = 0, it effectively increases the focal length to have a rectangular undistorted image where all pixels correspond to a pixel in the original. You lose data from the periphery, but you don&#x27;t have any padded pixels without valid data</li>
<li class="nx-my-2">If alpha = 1, all source pixels are undistorted, which can lead to a non-rectangular image region - visible in the black pincushioning. Because the image has to be rectangular in memory, the gaps are padded with black pixels</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="alpha = 0 (left) and alpha = 1 (right)" loading="lazy" width="1322" height="384" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 80&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAMAAABSSm3fAAAAElBMVEV4eHiEhIRra2tiYmKWlpZtbW1/eYjCAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAGklEQVR4nGNgZGVkYGJmYGZgYWBkYWBiYAQAAR8AHIRP4OgAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-06_at_09.16.17.3f881191.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">alpha = 0 (left) and alpha = 1 (right)</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Two ways of undistort:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><a href="https://docs.opencv.org/3.4.15/da/d54/group__imgproc__transform.html#ga69f2545a8b62a6b0fc2ee060dc30559d" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">cv.undistort<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
</ol>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">newcameramtx</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> roi </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getOptimalNewCameraMatrix</span><span style="color:var(--shiki-token-punctuation)">(mtx, dist, (w, h), </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, (w, h))</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">image </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">undistort</span><span style="color:var(--shiki-token-punctuation)">(image, mtx, dist, </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">, newcameramtx)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">x</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> y</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> w</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> h </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> roi</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">image </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> image</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-color-text)">y</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-color-text)">y </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> h</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> x</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-color-text)">x </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> w</span><span style="color:var(--shiki-token-punctuation)">]</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6" start="2">
<li class="nx-my-2"><a href="https://docs.opencv.org/3.4.15/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">cv.initUndistortRectifyMap<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> and <a href="https://docs.opencv.org/3.4.15/da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">cv.remap<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
</ol>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">newcameramtx</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> roi </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getOptimalNewCameraMatrix</span><span style="color:var(--shiki-token-punctuation)">(mtx, dist, (w, h), </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, (w, h))</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">mapx</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> mapy </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">initUndistortRectifyMap</span><span style="color:var(--shiki-token-punctuation)">(mtx, dist, </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">, newcameramtx, dim, </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">image </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">remap</span><span style="color:var(--shiki-token-punctuation)">(image, mapx, mapy, cv2.INTER_LINEAR)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">x</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> y</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> w</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> h </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> roi</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">image </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> image</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-color-text)">y</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-color-text)">y </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> h</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> x</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-color-text)">x </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> w</span><span style="color:var(--shiki-token-punctuation)">]</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Step 6. Check: Re-projection Error</strong></p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">mean_error </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> i </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">range</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-function)">len</span><span style="color:var(--shiki-token-punctuation)">(objpoints)):</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    imgpoints2</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _ </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">projectPoints</span><span style="color:var(--shiki-token-punctuation)">(objpoints[i], rvecs[i], tvecs[i], mtx, dist)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    error </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">norm</span><span style="color:var(--shiki-token-punctuation)">(imgpoints[i], imgpoints2, cv.NORM_L2)</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-token-function)">len</span><span style="color:var(--shiki-token-punctuation)">(imgpoints2)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    mean_error </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-color-text)"> error</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">( </span><span style="color:var(--shiki-token-string-expression)">&quot;total error: </span><span style="color:var(--shiki-token-constant)">{}</span><span style="color:var(--shiki-token-string-expression)">&quot;</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">format</span><span style="color:var(--shiki-token-punctuation)">(mean_error</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-token-function)">len</span><span style="color:var(--shiki-token-punctuation)">(objpoints)) )</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<details class="nx-my-4 nx-rounded nx-border nx-border-gray-200 nx-bg-white nx-p-2 nx-shadow-sm first:nx-mt-0 dark:nx-border-neutral-800 dark:nx-bg-neutral-900"><summary class="nx-flex nx-items-center nx-cursor-pointer nx-list-none nx-p-1 nx-transition-colors hover:nx-bg-gray-100 dark:hover:nx-bg-neutral-800 before:nx-mr-1 before:nx-inline-block before:nx-transition-transform before:nx-content-[&#x27;&#x27;] dark:before:nx-invert before:nx-shrink-0 rtl:before:nx-rotate-180 [[data-expanded]&gt;&amp;]:before:nx-rotate-90">full script</summary><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none" style="height:0"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-0">
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> cv2</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-color-text)"> tqdm </span><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> tqdm</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> numpy </span><span style="color:var(--shiki-token-keyword)">as</span><span style="color:var(--shiki-color-text)"> np</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">def</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">():</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># Set the path to the images captured by the left and right cameras</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    pathL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;./data/checkerStereoL/&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    pathR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;./data/checkerStereoR/&quot;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># Termination criteria for refining the detected corners</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    criteria </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">TERM_CRITERIA_EPS </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">TERM_CRITERIA_MAX_ITER</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">30</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.001</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    objp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">zeros</span><span style="color:var(--shiki-token-punctuation)">((</span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">), np.float32)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    objp</span><span style="color:var(--shiki-token-punctuation)">[:,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">]</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">mgrid</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">].</span><span style="color:var(--shiki-color-text)">T</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    img_ptsL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> []</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    img_ptsR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> []</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    obj_pts </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> []</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> i </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tqdm</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-function)">range</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">)):</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        imgL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-token-punctuation)">(pathL </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;img</span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)">.png&quot;</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">%</span><span style="color:var(--shiki-token-punctuation)"> i)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        imgR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-token-punctuation)">(pathR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;img</span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)">.png&quot;</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">%</span><span style="color:var(--shiki-token-punctuation)"> i)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        imgL_gray </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-token-punctuation)">(pathL </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;img</span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)">.png&quot;</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">%</span><span style="color:var(--shiki-token-punctuation)"> i, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        imgR_gray </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-token-punctuation)">(pathR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;img</span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)">.png&quot;</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">%</span><span style="color:var(--shiki-token-punctuation)"> i, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">        outputL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> imgL</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">copy</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        outputR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> imgR</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">copy</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">        retR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> cornersR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">findChessboardCorners</span><span style="color:var(--shiki-token-punctuation)">(outputR, (</span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">), </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        retL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> cornersL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">findChessboardCorners</span><span style="color:var(--shiki-token-punctuation)">(outputL, (</span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">), </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> retR </span><span style="color:var(--shiki-token-keyword)">and</span><span style="color:var(--shiki-color-text)"> retL</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            obj_pts</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">(objp)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">cornerSubPix</span><span style="color:var(--shiki-token-punctuation)">(imgR_gray, cornersR, (</span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">), (</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">), criteria)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">cornerSubPix</span><span style="color:var(--shiki-token-punctuation)">(imgL_gray, cornersL, (</span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">11</span><span style="color:var(--shiki-token-punctuation)">), (</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">), criteria)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">drawChessboardCorners</span><span style="color:var(--shiki-token-punctuation)">(outputR, (</span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">), cornersR, retR)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">drawChessboardCorners</span><span style="color:var(--shiki-token-punctuation)">(outputL, (</span><span style="color:var(--shiki-token-constant)">9</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">6</span><span style="color:var(--shiki-token-punctuation)">), cornersL, retL)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imshow</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;cornersR&quot;</span><span style="color:var(--shiki-token-punctuation)">, outputR)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imshow</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;cornersL&quot;</span><span style="color:var(--shiki-token-punctuation)">, outputL)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">waitKey</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">            img_ptsL</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">(cornersL)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            img_ptsR</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">(cornersR)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">### Calibrating left camera ###</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    retL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> mtxL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> distL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> rvecsL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> tvecsL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">calibrateCamera</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        obj_pts, img_ptsL, imgL_gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">], </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">None</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    hL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> wL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> imgL_gray</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span><span style="color:var(--shiki-token-punctuation)">[:</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    new_mtxL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> roiL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getOptimalNewCameraMatrix</span><span style="color:var(--shiki-token-punctuation)">(mtxL, distL, (wL, hL), </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, (wL, hL))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">### Calibrating right camera ###</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    retR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> mtxR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> distR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> rvecsR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> tvecsR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">calibrateCamera</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        obj_pts, img_ptsR, imgR_gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">], </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">None</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    hR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> wR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> imgR_gray</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span><span style="color:var(--shiki-token-punctuation)">[:</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    new_mtxR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> roiR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getOptimalNewCameraMatrix</span><span style="color:var(--shiki-token-punctuation)">(mtxR, distR, (wR, hR), </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, (wR, hR))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">### Stereo Calibrate ###</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    flags </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    flags </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">CALIB_FIX_INTRINSIC</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    criteria_stereo </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">TERM_CRITERIA_EPS </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">TERM_CRITERIA_MAX_ITER</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">30</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.001</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># This step is performed to transformation between the two cameras and calculate Essential and Fundamenatl matrix</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    retS</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> new_mtxL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> distL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> new_mtxR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> distR</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> Rot</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> Trns</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> Emat</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> Fmat </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">stereoCalibrate</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        obj_pts,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        img_ptsL,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        img_ptsR,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        new_mtxL,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        distL,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        new_mtxR,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        distR,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        imgL_gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">],</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        criteria_stereo,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        flags,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">### Stereo Rectify ###</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    rectify_scale </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    rect_l</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> rect_r</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> proj_mat_l</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> proj_mat_r</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> Q</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> roiL</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> roiR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">stereoRectify</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        new_mtxL,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        distL,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        new_mtxR,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        distR,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        imgL_gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">],</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        Rot,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        Trns,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        rectify_scale,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        (</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">),</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">### Undistord rectified stereo image ###</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    Left_Stereo_Map </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">initUndistortRectifyMap</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        new_mtxL, distL, rect_l, proj_mat_l, imgL_gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">], cv2.CV_16SC2</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    Right_Stereo_Map </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">initUndistortRectifyMap</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        new_mtxR, distR, rect_r, proj_mat_r, imgR_gray.shape[::</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">], cv2.CV_16SC2</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Saving parameters ......&quot;</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">FileStorage</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;data/improved_params2.xml&quot;</span><span style="color:var(--shiki-token-punctuation)">, cv2.FILE_STORAGE_WRITE)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">write</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Left_Stereo_Map_x&quot;</span><span style="color:var(--shiki-token-punctuation)">, Left_Stereo_Map[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">])</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">write</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Left_Stereo_Map_y&quot;</span><span style="color:var(--shiki-token-punctuation)">, Left_Stereo_Map[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">])</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">write</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Right_Stereo_Map_x&quot;</span><span style="color:var(--shiki-token-punctuation)">, Right_Stereo_Map[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">])</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">write</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Right_Stereo_Map_y&quot;</span><span style="color:var(--shiki-token-punctuation)">, Right_Stereo_Map[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">])</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">write</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Q&quot;</span><span style="color:var(--shiki-token-punctuation)">, Q)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv_file</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">release</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">__name__</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;__main__&quot;</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-token-punctuation)">()</span><span style="color:var(--shiki-token-keyword)">%</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</div></div></details>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Focus on Perspective n Points (used by calibrateCamera)<a href="#focus-on-perspective-n-points-used-by-calibratecamera" id="focus-on-perspective-n-points-used-by-calibratecamera" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://learnopencv.com/head-pose-estimation-using-opencv-and-dlib/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://learnopencv.com/head-pose-estimation-using-opencv-and-dlib/<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The goal of Perspective-n-Point is to find the pose of an object when</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">we have a calibrated camera</li>
<li class="nx-my-2">we know the locations of n 3D points on the object and the corresponding 2D projections in the image</li>
</ol>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-04 at 09.10.49.png" loading="lazy" width="1356" height="874" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 200&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAAMFBMVEX///97enrv7e3y8fFbXFz6+Pj19fX4+PidnJxqaWmHh4ehoKDCvr7Y2NgqKiq8ubloBuOiAAAACXBIWXMAABYlAAAWJQFJUiTwAAAALUlEQVR4nBXGSRIAIAgEsR5Acff/v7XMKVAqu8eCrEgjwCxnG/pxuwpIp6mfBxClAL89UWvnAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-04_at_09.10.49.48211945.png"/></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Estimating the pose is finding 6 degrees of freedom (3 for translation + 3 for rotation)</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-04 at 09.14.36.png" loading="lazy" width="700" height="232" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 120&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAACVBMVEX29vbu7u7k5OTmsRxMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAGklEQVR4nGNgZAABRkYGJkZGRgZGJggfJAIAANoAD4Z1MScAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-04_at_09.14.36.99f50dbd.png"/></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We need</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>2D coordinates of a few points</strong></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Dlib’s <a href="https://learnopencv.com/facial-landmark-detection/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">facial landmark detector<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> provides us with many points to choose from</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>3D locations of the same points</strong></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">You just need the 3D locations of a few points in some arbitrary reference frame (called <strong>World Coordinates)</strong>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Tip of the nose : ( 0.0, 0.0, 0.0)</li>
<li class="nx-my-2">Chin : ( 0.0, -330.0, -65.0)</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><em>Direct Linear Transform</em> is used to solve extrinsic matrix, and can be used anytime when the equation is almost linear but is off by an unknown scale.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">However, DLT solution does not minimize the correct objective function. Ideally, we want to minimize the <strong>reprojection error.</strong></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">When the pose estimate is incorrect, we can calculate a <strong>re-projection error</strong> measure — the sum of squared distances between the projected 3D points and 2D facial feature points.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Levenberg-Marquardt<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> optimization allows to iteratively change the values of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.00773em">R</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span></span></span></span> so that the reprojection error decreases. LM is often used for non linear least square problems.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/4.5.0/d9/d0c/group__calib3d.html#ga50620f0e26e02caa2e9adc07b5fbf24e" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::solvePnPRansac</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> instead of <a href="https://docs.opencv.org/4.5.0/d9/d0c/group__calib3d.html#ga549c2075fac14829ff4a58bc931c033d" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::solvePnP</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> because after the matching not all the found correspondences are correct (outliers)</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ransac is an outlier detection method that fits linear models to several random samplings of the data and returning the model that has the best fit to a subset of the data.
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Select a random subset of the data</li>
<li class="nx-my-2">A model is fitted to the set of hypothetical inliers</li>
<li class="nx-my-2">All other data are then tested against the fitted model.</li>
<li class="nx-my-2">The estimated model is reasonably good if sufficiently many points have been classified as part of the consensus set</li>
<li class="nx-my-2">Repeat</li>
</ol>
</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-27 at 10.46.16.png" loading="lazy" width="1346" height="732" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 160&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAABlBMVEX8+/z19fUjcAquAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAEUlEQVR4nGNgwAoYwQQEMAAAAFQACSZCJ48AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-27_at_10.46.16.8be7a9a1.png"/></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">full script</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="cpp" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="cpp" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">#</span><span style="color:var(--shiki-token-keyword)">!/</span><span style="color:var(--shiki-color-text)">usr</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)">bin</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)">env python</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">import cv2</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">import numpy as np</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)"># Read Image</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">im </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;headPose.jpg&quot;</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">size </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">im</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">#</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-keyword)">D</span><span style="color:var(--shiki-color-text)"> image </span><span style="color:var(--shiki-token-constant)">points</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)"> If you change the image</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> you need to change vector</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">image_points </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">array</span><span style="color:var(--shiki-color-text)">([</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">359</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">391</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">     # Nose tip</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">399</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">561</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">     # Chin</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">337</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">297</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">     # Left eye left corner</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">513</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">301</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">     # Right eye right corne</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">345</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">465</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">     # Left Mouth corner</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">453</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">469</span><span style="color:var(--shiki-color-text)">)      # Right mouth corner</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                        ]</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> dtype</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-string-expression)">&quot;double&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)"># </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-keyword)">D</span><span style="color:var(--shiki-color-text)"> model points.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">model_points </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">array</span><span style="color:var(--shiki-color-text)">([</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">0.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.0</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">             # Nose tip</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">0.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">330.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">65.0</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">        # Chin</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">225.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">170.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">135.0</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">     # Left eye left corner</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">225.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">170.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">135.0</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">      # Right eye right corne</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">150.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">150.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">125.0</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">    # Left Mouth corner</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                            (</span><span style="color:var(--shiki-token-constant)">150.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">150.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">125.0</span><span style="color:var(--shiki-color-text)">)      # Right mouth corner</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">                        ])</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)"># Camera internals</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">focal_length </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">size</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">center </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">size</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">size</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">]</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">camera_matrix </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">array</span><span style="color:var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                         </span><span style="color:var(--shiki-token-constant)">[[focal_length</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)"> 0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)"> center[0]]</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                         [</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> focal_length</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">center</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]]</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                         [</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]]</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> dtype </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;double&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                         )</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">print </span><span style="color:var(--shiki-token-string-expression)">&quot;Camera Matrix :\n {0}&quot;</span><span style="color:var(--shiki-color-text)">.</span><span style="color:var(--shiki-token-function)">format</span><span style="color:var(--shiki-color-text)">(camera_matrix)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">dist_coeffs </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">zeros</span><span style="color:var(--shiki-color-text)">((</span><span style="color:var(--shiki-token-constant)">4</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">)) # Assuming no lens distortion</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">(success</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> rotation_vector</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> translation_vector) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">solvePnP</span><span style="color:var(--shiki-color-text)">(model_points</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> image_points</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> camera_matrix</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> dist_coeffs</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> flags</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)">cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">CV_ITERATIVE)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">print </span><span style="color:var(--shiki-token-string-expression)">&quot;Rotation Vector:\n {0}&quot;</span><span style="color:var(--shiki-color-text)">.</span><span style="color:var(--shiki-token-function)">format</span><span style="color:var(--shiki-color-text)">(rotation_vector)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">print </span><span style="color:var(--shiki-token-string-expression)">&quot;Translation Vector:\n {0}&quot;</span><span style="color:var(--shiki-color-text)">.</span><span style="color:var(--shiki-token-function)">format</span><span style="color:var(--shiki-color-text)">(translation_vector)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)"># Project a </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-keyword)">D</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">point</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1000.0</span><span style="color:var(--shiki-color-text)">) onto the image plane.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"># We use </span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-color-text)"> to draw a line sticking out of the nose</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">(nose_end_point2D</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> jacobian) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">projectPoints</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">array</span><span style="color:var(--shiki-color-text)">([(</span><span style="color:var(--shiki-token-constant)">0.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1000.0</span><span style="color:var(--shiki-color-text)">)]), rotation_vector, translation_vector, camera_matrix, dist_coeffs)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">for p in image_points:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv2.circle(</span><span style="color:var(--shiki-token-function)">im</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-function)">p</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">]), int(</span><span style="color:var(--shiki-token-function)">p</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">])), 3, (0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">255), -1)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">p1 = ( </span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-function)">image_points</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">][</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">]), int(</span><span style="color:var(--shiki-token-function)">image_points</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">][</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]))</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">p2 = ( </span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-function)">nose_end_point2D</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">][</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">][</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">]), int(</span><span style="color:var(--shiki-token-function)">nose_end_point2D</span><span style="color:var(--shiki-color-text)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">][</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">][</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">cv2.line(</span><span style="color:var(--shiki-token-function)">im</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">p1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">p2</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> (255</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">0), 2)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)"># Display image</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">cv2.imshow(&quot;</span><span style="color:var(--shiki-token-function)">Output</span><span style="color:var(--shiki-token-string-expression)">&quot;, im)</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">cv2.waitKey(0)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-04 at 09.34.56.png" loading="lazy" width="1024" height="580" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 200&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAARVBMVEXNy76VhHrCtajo3dW+u6+xinh0YlzEwrK0sKTPx754a2idpKaUdWe1pZNMOjbTzLhlcoNqZGTSuKa9oZeKk6Tb1M2+vcZeCB4iAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAMklEQVR4nAXBCQKAIAgAwVVQwA7Lo/8/tRkk2uvqhoxyp56DmOW8zGDnVB2Db7X6HMoPHhMBVPK9JtEAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-04_at_09.34.56.16f1cad0.png"/></p>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Epipolar Geometry<a href="#epipolar-geometry" id="epipolar-geometry" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/3.4.15/da/de9/tutorial_py_epipolar_geometry.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/3.4.15/da/de9/tutorial_py_epipolar_geometry.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://learnopencv.com/introduction-to-epipolar-geometry-and-stereo-vision/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://learnopencv.com/introduction-to-epipolar-geometry-and-stereo-vision/<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://web.stanford.edu/class/cs231a/course_notes/03-epipolar-geometry.pdf" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://web.stanford.edu/class/cs231a/course_notes/03-epipolar-geometry.pdf<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-09 at 10.02.23.png" loading="lazy" width="930" height="382" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 120&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAABlBMVEX9/f339/cAbJwOAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAFUlEQVR4nGNgYGBgZIAARhAA02A2AACGAAxW7ZBrAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-09_at_10.02.23.05679536.png"/></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">The projection of the different points on OX form a line on right plane (line l′). We call it <strong>epiline</strong> corresponding to the point</li>
<li class="nx-my-2">Similarly all points will have its corresponding epilines in the other image. The plane XOO′ is called <strong>Epipolar Plane</strong>.</li>
<li class="nx-my-2">O and O′ are the camera centers. Projection of right camera O′ is seen on the left image at the point, e. It is called the <strong>epipole</strong></li>
<li class="nx-my-2">All the epilines pass through its epipole. So to find the location of epipole, we can find many epilines and find their intersection point.</li>
<li class="nx-my-2">So in this session, we focus on finding epipolar lines and epipoles</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-10 at 08.47.17.png" loading="lazy" width="902" height="488" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 160&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAFVBMVEX6+vru7u729vb////o6OjY19jBwMCzhRLDAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAIUlEQVR4nAXBgQEAMAyCMES7/09eQlttCwqxsO3egYlZ/AVgAEswO1P+AAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-10_at_08.47.17.d2ea2490.png"/></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">But to find epipolar lines, we need two more ingredients, <strong>Fundamental Matrix (F)</strong> and <strong>Essential Matrix (E)</strong>.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Essential Matrix contains the information about translation and rotation, which describe the location of the second camera relative to the first in global coordinates</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Fundamental Matrix contains the same information as Essential Matrix in addition to the information about the intrinsics of both cameras so that we can relate the two cameras in pixel coordinates</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Fundamental Matrix F, maps a point in one image to a line (epiline) in the other image</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">If we are using rectified images and normalize the point by dividing by the focal lengths, F=E</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">A minimum of 8 such points are required to find the fundamental matrix (while using 8-point algorithm). More points are preferred and use RANSAC to get a more robust result.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">full script</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)"># find the keypoints and descriptors with SIFT</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">sift </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">SIFT_create</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">kp1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> des1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> sift</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">detectAndCompute</span><span style="color:var(--shiki-token-punctuation)">(img1, </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">kp2</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> des2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> sift</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">detectAndCompute</span><span style="color:var(--shiki-token-punctuation)">(img2, </span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># FLANN parameters</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">FLANN_INDEX_KDTREE </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">index_params </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">dict</span><span style="color:var(--shiki-token-punctuation)">(algorithm</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">FLANN_INDEX_KDTREE, trees</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">search_params </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">dict</span><span style="color:var(--shiki-token-punctuation)">(checks</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)">50</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">flann </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">FlannBasedMatcher</span><span style="color:var(--shiki-token-punctuation)">(index_params,search_params)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">matches </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> flann</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">knnMatch</span><span style="color:var(--shiki-token-punctuation)">(des1 , des2, k</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">pts1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> []</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">pts2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> []</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># ratio test as per Lowe&#x27;s paper</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> i</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">(m</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)">n) </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">enumerate</span><span style="color:var(--shiki-token-punctuation)">(matches):</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> m</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">distance </span><span style="color:var(--shiki-token-keyword)">&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.8</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">n</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">distance</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        pts2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">(kp2[m.trainIdx].pt)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        pts1</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">(kp1[m.queryIdx].pt)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Now we have the list of best matches from both the images.</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Let&#x27;s find the Fundamental Matrix.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">pts1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">int32</span><span style="color:var(--shiki-token-punctuation)">(pts1)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">pts2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">int32</span><span style="color:var(--shiki-token-punctuation)">(pts2)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">F</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> mask </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">findFundamentalMat</span><span style="color:var(--shiki-token-punctuation)">(pts1, pts2, cv.FM_LMEDS)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># We select only inlier points</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">pts1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> pts1</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-color-text)">mask</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">ravel</span><span style="color:var(--shiki-token-punctuation)">()</span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">pts2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> pts2</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-color-text)">mask</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">ravel</span><span style="color:var(--shiki-token-punctuation)">()</span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Find epilines corresponding to points in right image (second image) and</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># drawing its lines on left image</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">lines1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">computeCorrespondEpilines</span><span style="color:var(--shiki-token-punctuation)">(pts2.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">), </span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">, F)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">lines1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> lines1</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">img5</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _ </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">drawlines</span><span style="color:var(--shiki-token-punctuation)">(img1, img2, lines1, pts1, pts2)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Find epilines corresponding to points in left image (first image) and</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># drawing its lines on right image</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">lines2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">computeCorrespondEpilines</span><span style="color:var(--shiki-token-punctuation)">(pts1.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">), </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, F)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">lines2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> lines2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">img3</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _ </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">drawlines</span><span style="color:var(--shiki-token-punctuation)">(img2, img1, lines2, pts2, pts1)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-10 at 09.27.49.png" loading="lazy" width="890" height="666" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 240&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAKlBMVEU5OzmXl5dmaGiJiYlRUlInJydHSEhfXl52dXZ7e3sYGhdrbWyBgH9ZV1gRxw7YAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAL0lEQVR4nBXItxEAIBAEsb33mP7rZVAoTheZe0OvAAqTLwuS9pkoEnP5/LMrSX4eF8oA1CNgwr4AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-10_at_09.27.49.b4371408.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-10 at 09.27.53.png" loading="lazy" width="894" height="666" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 240&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAANlBMVEV6dnpGR0dhYWGZl5lSUFKqqqqKhIqDgIE6ODtbWFpybnKTkJAtMTGenZ5vbmhgZ2YXHBsdIyKvoYK6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAMklEQVR4nAXBCQIAEQwEwUaOCfbw/8+qQvv829pHmaqqOmrGypxIRpAvnVwQkxzu/oy4Jo4BQxHsTA8AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-10_at_09.27.53.3193f049.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">You can see in the left image that all epilines are converging at a point outside the image at right side. That meeting point is the epipole.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">For better results, images with good resolution and many non-planar points should be used.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://answers.opencv.org/question/18125/epilines-not-correct/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://answers.opencv.org/question/18125/epilines-not-correct/<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">The problem with this particular scene is that almost all matched points lie on the same plane in 3d space. This is a known degenerate case for fundamental matrix estimation. Take a look [these slides](<a href="https://www.dropbox.com/s/gpx63bam1i5frdz/geometry-for-computer-vision-lecture-5.pdf?dl=0" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://www.dropbox.com/s/gpx63bam1i5frdz/geometry-for-computer-vision-lecture-5.pdf?dl=0<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>](<a href="https://www.dropbox.com/s/gpx63bam1i5frdz/geometry-for-computer-vision-lecture-5.pdf" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://www.dropbox.com/s/gpx63bam1i5frdz/geometry-for-computer-vision-lecture-5.pdf<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>) for explanation. I tried to increase 2nd nearest neighbor threshold in this code from 0.7 to 0.8:</li>
<li class="nx-my-2">In general fundamental matrix estimation is very sensitive to quality of matches and number of outliers, since opencv uses 8-point algorithm for model estimation. Try to work with higher resolution images with rich textures and non-planar scenes.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://answers.opencv.org/question/17912/location-of-epipole/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://answers.opencv.org/question/17912/location-of-epipole/<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-10 at 09.44.17.png" loading="lazy" width="1240" height="1532" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 240 320&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAICAMAAADtGH4KAAAAJFBMVEX////8/Pv19fX4+Pfx8fDu7evEx8ZRXFTS2d1VaYKzraJhbHWu1ucWAAAACXBIWXMAABYlAAAWJQFJUiTwAAAALklEQVR4nB3JyREAMAgDscUm5Oq/3wx56SFY+xZQcx4gpPhkQw5D2JZASveNdDwRFgCCF9peMQAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-10_at_09.44.17.67283424.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://learnopencv.com/introduction-to-epipolar-geometry-and-stereo-vision/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://learnopencv.com/introduction-to-epipolar-geometry-and-stereo-vision/<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>equivalent</strong> vectors, which are related by just a scaling constant, form a class of <strong>homogeneous vectors</strong></li>
<li class="nx-my-2">The set of all equivalent classes, represented by (a,b,c) forms the <strong>projective space.</strong></li>
<li class="nx-my-2">We use the homogeneous representation of homogeneous coordinates to define elements like points, lines, planes, etc., in projective space.</li>
<li class="nx-my-2">We use the rules of <strong>projective geometry</strong> to perform any transformations on these elements in the projective space.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-12 at 09.08.31.png" loading="lazy" width="786" height="410" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 160&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAACVBMVEX09PT9/f3r6+vhKAHrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAH0lEQVR4nB3GwQ0AMBCDMJz9h66uPCxCHfrJxnYbrQcBuwAZMf2a7QAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-12_at_09.08.31.c4d89082.png"/></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Camera calibration gives us the projection matrix <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">C_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">C_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We define the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>C</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[C_1,x_1,X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="mclose">)</span></span></span></span> ray as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mi>P</mi><mn>1</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mi>k</mi><msub><mi>C</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">X(k)=P_1^{-1}x_1+kC_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2663em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em"><span style="top:-2.4337em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1031em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>P</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">P^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> is the pseudo inverse of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span></span></span></span> is a scaling parameter as we do not know the actual distance C1 → X</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Need to find epipolar line <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">L_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> to reduce the search space for a pixel in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">i_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> corresponding to pixel <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">i_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Hence to calculate <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">L_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>, we first find two points on ray <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>, and project them in image <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">i_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> using <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Let&#x27;s use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">C_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>P</mi><mn>1</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>x</mi><mn>1</mn></msub><mtext>  </mtext><mo stretchy="false">(</mo><mi>k</mi><mo>=</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P_1^{-1}x_1\;(k=0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2663em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em"><span style="top:-2.4337em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1031em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span>: it yields <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub><msub><mi>C</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_2C_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> (the epipole <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">e_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>) and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub><msubsup><mi>P</mi><mn>1</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_2P_1^{-1}x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2663em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em"><span style="top:-2.4337em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1031em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">In projective geometry, a line can be define with the cross product of two points</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo>=</mo><msub><mi>e</mi><mn>2</mn></msub><msub><mi>P</mi><mn>2</mn></msub><msubsup><mi>P</mi><mn>1</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mi>F</mi><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">L_2=e_2P_2P_1^{-1}x_1=Fx_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2663em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8542em"><span style="top:-2.4337em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1031em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">F</span></span></span></span> fundamental matrix</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">In projective geometry, if a point x lies on a line L:</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mi>T</mi></msup><mi>L</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x^TL=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Thus, as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> lies on epiline</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mn>2</mn><mi>T</mi></msubsup><mi>F</mi><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x_2^TFx_1=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0894em;vertical-align:-0.2481em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">This is a necessary condition for the two points x1 and x2 to be corresponding points, and it is also a form of epipolar constraint</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Let&#x27;s use the F matrix to find epilines:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">We use feature matching methods like ORB or SIFT to find matching points to solve the above equation for F.</li>
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">findFundamentalMat()</code> ******provides implementations of 7-Point Algorithm, 8-Point Algorithm, RANSAC algorithm, and LMedS Algorithm, to calculate F using matched feature points.</li>
</ol>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Depthmap<a href="#depthmap" id="depthmap" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/4.5.4/dd/d53/tutorial_py_depthmap.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/4.5.4/dd/d53/tutorial_py_depthmap.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://learnopencv.com/making-a-low-cost-stereo-camera-using-opencv/#performing-stereo-calibration-with-fixed-intrinsic-parameters" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://learnopencv.com/making-a-low-cost-stereo-camera-using-opencv/#performing-stereo-calibration-with-fixed-intrinsic-parameters<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We simplify the dense matching problem even more with stereo disparity</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-13 at 10.48.18.png" loading="lazy" width="1212" height="604" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 160&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAJFBMVEWRkZKDf4Kdmp2Ggoh/foBSU1JnZ2Zta2xERkWMhoxxb3BdXl5iMcnGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAJklEQVR4nBXBiREAMAgCMMBf99+31wRuRpL4bDQOqVZ+i8zoio4HB2YAjIKgPVsAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-13_at_10.48.18.5d4e4ca6.png"/></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">All the epipolar lines have to be parallel and have the same vertical coordinate left and right</li>
<li class="nx-my-2">We still have to perform triangulation for each point. We use <strong>stereo disparity.</strong></li>
</ul>
</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-13 at 11.24.13.png" loading="lazy" width="932" height="808" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 280&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAMAAAACh/xsAAAAD1BMVEX6+vr////y8vLq6urZ2dmBLrNaAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAKElEQVR4nCXIwQ0AIADCwBbcf2aDPkouoAZ1Dbw+yDbYSPc2zQOcghcGzAA8UtSKFwAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-13_at_11.24.13.71c90141.png"/></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mtext>–</mtext><mi>x</mi><mo>=</mo><mi>B</mi><mi>f</mi><mi mathvariant="normal">/</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">disparity= x&#x27; – x = Bf/Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7519em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">–</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.07153em">Z</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span> is the baseline, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span> the focal length</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">StereoSGBM</code></p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)"># Setting parameters for StereoSGBM algorithm</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># the offset from the x-position of the left pixel at which to begin searching.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">minDisparity </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># How many pixels to slide the window over.</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># The larger it is, the larger the range of visible depths, </span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># but more computation is required.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">numDisparities </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">64</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">blockSize </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">8</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">disp12MaxDiff </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># speckle_size is the number of pixels below which a disparity blob</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># is dismissed as &quot;speckle.&quot; </span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># speckle_range controls how close in value disparities must be </span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># to be considered part of the same blob.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">speckleWindowSize </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">10</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">speckleRange </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">8</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># filters out areas that don&#x27;t have enough texture for reliable matching</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># texture_threshold = ?</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Another post-filtering step. </span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># If the best matching disparity is not sufficiently better than </span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># every other disparity in the search range, the pixel is filtered out.</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># You can try tweaking this if texture_threshold and the speckle filtering</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"># are still letting through spurious matches.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">uniquenessRatio </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">10</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Creating an object of StereoSGBM algorithm</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">stereo </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">StereoSGBM_create</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">		minDisparity</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">minDisparity,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    numDisparities</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">numDisparities,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    blockSize</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">blockSize,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    disp12MaxDiff</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">disp12MaxDiff,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    uniquenessRatio</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">uniquenessRatio,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    speckleWindowSize</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">speckleWindowSize,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    speckleRange</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">speckleRange,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Calculating disparith using the StereoSGBM algorithm</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">disp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> stereo</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">compute</span><span style="color:var(--shiki-token-punctuation)">(imgL, imgR).</span><span style="color:var(--shiki-token-function)">astype</span><span style="color:var(--shiki-token-punctuation)">(np.float32)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">disp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">normalize</span><span style="color:var(--shiki-token-punctuation)">(disp, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">, cv2.NORM_MINMAX)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-11-13 at 11.20.13.png" loading="lazy" width="1402" height="468" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 120&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAAHlBMVEVhYWGHh4dcXFxMTEyTk5N+fn5VVVVBQUEhISFubm4sLDzjAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAIUlEQVR4nAXBhwEAMAzCMANZ/f/hSjS0b81MvNFDSKHqAwS0AFFYZ/UTAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-11-13_at_11.20.13.f0928bc8.png"/></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">full script, create mesh 3D</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> numpy </span><span style="color:var(--shiki-token-keyword)">as</span><span style="color:var(--shiki-color-text)"> np</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> cv2 </span><span style="color:var(--shiki-token-keyword)">as</span><span style="color:var(--shiki-color-text)"> cv</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">ply_header </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&#x27;&#x27;&#x27;ply</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">format ascii 1.0</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">element vertex </span><span style="color:var(--shiki-token-constant)">%(vert_num)d</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">property float x</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">property float y</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">property float z</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">property uchar red</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">property uchar green</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">property uchar blue</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">end_header</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">&#x27;&#x27;&#x27;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">def</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">write_ply</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-parameter)">fn</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-parameter)">verts</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-parameter)">colors</span><span style="color:var(--shiki-color-text)">):</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    verts </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> verts</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    colors </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> colors</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reshape</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    verts </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">hstack</span><span style="color:var(--shiki-token-punctuation)">([verts, colors])</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">with</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">open</span><span style="color:var(--shiki-token-punctuation)">(fn, </span><span style="color:var(--shiki-token-string-expression)">&#x27;wb&#x27;</span><span style="color:var(--shiki-token-punctuation)">)</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">as</span><span style="color:var(--shiki-color-text)"> f</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        f</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">write</span><span style="color:var(--shiki-token-punctuation)">((ply_header </span><span style="color:var(--shiki-token-keyword)">%</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">dict</span><span style="color:var(--shiki-token-punctuation)">(vert_num</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)">len</span><span style="color:var(--shiki-token-punctuation)">(verts))).</span><span style="color:var(--shiki-token-function)">encode</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;utf-8&#x27;</span><span style="color:var(--shiki-token-punctuation)">))</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">savetxt</span><span style="color:var(--shiki-token-punctuation)">(f, verts, fmt</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-string-expression)">&#x27;</span><span style="color:var(--shiki-token-constant)">%f</span><span style="color:var(--shiki-token-string-expression)"> </span><span style="color:var(--shiki-token-constant)">%f</span><span style="color:var(--shiki-token-string-expression)"> </span><span style="color:var(--shiki-token-constant)">%f</span><span style="color:var(--shiki-token-string-expression)"> </span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)"> </span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)"> </span><span style="color:var(--shiki-token-constant)">%d</span><span style="color:var(--shiki-token-string-expression)"> &#x27;</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">def</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">():</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;loading images...&#x27;</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    imgL </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">pyrDown</span><span style="color:var(--shiki-token-punctuation)">(cv.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;aloeL.jpeg&#x27;</span><span style="color:var(--shiki-token-punctuation)">))</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)"># downscale images for faster processing</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    imgR </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">pyrDown</span><span style="color:var(--shiki-token-punctuation)">(cv.</span><span style="color:var(--shiki-token-function)">imread</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;aloeR.jpeg&#x27;</span><span style="color:var(--shiki-token-punctuation)">))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># disparity range is tuned for &#x27;aloe&#x27; image pair</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    window_size </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">3</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    min_disp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">16</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    num_disp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">112</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)">min_disp</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    stereo </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">StereoSGBM_create</span><span style="color:var(--shiki-token-punctuation)">(minDisparity </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> min_disp,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        numDisparities </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> num_disp,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        blockSize </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">16</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        P1 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">8</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)">window_size</span><span style="color:var(--shiki-token-keyword)">**</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        P2 </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">32</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)">window_size</span><span style="color:var(--shiki-token-keyword)">**</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        disp12MaxDiff </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        uniquenessRatio </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">10</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        speckleWindowSize </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">100</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">        speckleRange </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">32</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">    )</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;computing disparity...&#x27;</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    disp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> stereo</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">compute</span><span style="color:var(--shiki-token-punctuation)">(imgL, imgR).</span><span style="color:var(--shiki-token-function)">astype</span><span style="color:var(--shiki-token-punctuation)">(np.float32)</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">16.0</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;generating 3d point cloud...&#x27;</span><span style="color:var(--shiki-token-punctuation)">,)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    h</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> w </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> imgL</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span><span style="color:var(--shiki-token-punctuation)">[:</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    f </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0.8</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">w                          </span><span style="color:var(--shiki-token-comment)"># guess for focal length</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    Q </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> np</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">float32</span><span style="color:var(--shiki-token-punctuation)">([[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">0.5</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)">w],</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">                    [</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,  </span><span style="color:var(--shiki-token-constant)">0.5</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)">h], </span><span style="color:var(--shiki-token-comment)"># turn points 180 deg around x-axis,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">                    [</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,     </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-punctuation)">f], </span><span style="color:var(--shiki-token-comment)"># so that y-axis looks up</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">                    [</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,      </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">]])</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    points </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reprojectImageTo3D</span><span style="color:var(--shiki-token-punctuation)">(disp, Q)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    colors </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">cvtColor</span><span style="color:var(--shiki-token-punctuation)">(imgL, cv.COLOR_BGR2RGB)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    mask </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> disp </span><span style="color:var(--shiki-token-keyword)">&gt;</span><span style="color:var(--shiki-color-text)"> disp</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">min</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    out_points </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> points</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-color-text)">mask</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    out_colors </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> colors</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-color-text)">mask</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    out_fn </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&#x27;out.ply&#x27;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">write_ply</span><span style="color:var(--shiki-token-punctuation)">(out_fn, out_points, out_colors)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;</span><span style="color:var(--shiki-token-constant)">%s</span><span style="color:var(--shiki-token-string-expression)"> saved&#x27;</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">%</span><span style="color:var(--shiki-token-punctuation)"> out_fn)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imshow</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;left&#x27;</span><span style="color:var(--shiki-token-punctuation)">, imgL)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imshow</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;disparity&#x27;</span><span style="color:var(--shiki-token-punctuation)">, (disp</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-punctuation)">min_disp)</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-token-punctuation)">num_disp)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">waitKey</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;Done&#x27;</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">__name__</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&#x27;__main__&#x27;</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-constant)">__doc__</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    cv</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">destroyAllWindows</span><span style="color:var(--shiki-token-punctuation)">()</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Q&amp;A<a href="#qa" id="qa" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="http://wiki.ros.org/stereo_image_proc/Tutorials/ChoosingGoodStereoParameters" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">http://wiki.ros.org/stereo_image_proc/Tutorials/ChoosingGoodStereoParameters<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://stackoverflow.com/questions/42737732/how-to-change-the-attributes-of-cv2-stereobm-create-for-depth-map-in-opencv-pyth" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://stackoverflow.com/questions/42737732/how-to-change-the-attributes-of-cv2-stereobm-create-for-depth-map-in-opencv-pyth<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Full API Documentation<a href="#full-api-documentation" id="full-api-documentation" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/2.4/modules/calib3d/doc/camera_calibration_and_3d_reconstruction.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/2.4/modules/calib3d/doc/camera_calibration_and_3d_reconstruction.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Consistent video depth estimation<a href="#consistent-video-depth-estimation" id="consistent-video-depth-estimation" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://www.youtube.com/watch?v=5Tia2oblJAg&amp;ab_channel=JohannesKopf" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://www.youtube.com/watch?v=5Tia2oblJAg&amp;ab_channel=JohannesKopf<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Pose Estimation using OpenCV<a href="#pose-estimation-using-opencv" id="pose-estimation-using-opencv" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/4.5.0/dc/d2c/tutorial_real_time_pose.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/4.5.0/dc/d2c/tutorial_real_time_pose.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">1. <strong>Model registration</strong><a href="#1-model-registration" id="1-model-registration" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Output</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Create your own textured 3D model</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Inputs</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">The application needs an input image of the object to be registered and its 3D mesh.</li>
<li class="nx-my-2">We have also to provide the intrinsic parameters of the camera with which the input image was taken.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Algo</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Starts up extracting the ORB features and descriptors from the input image</li>
<li class="nx-my-2">Uses the mesh along with the <a href="http://http//en.wikipedia.org/wiki/M%C3%B6ller%E2%80%93Trumbore_intersection_algorithm/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Möller–Trumbore intersection algorithm<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> to compute the 3D coordinates of the found features.</li>
<li class="nx-my-2">Finally, the 3D points and the descriptors are stored in different lists in a file with YAML format which each row is a different point</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">2. <strong>Model detection</strong><a href="#2-model-detection" id="2-model-detection" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Inputs</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">3D textured model in YAML file</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Algo</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Detect and extract ORB features and descriptors from the scene</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Matching between the scene descriptors and the model descriptor using <a href="https://docs.opencv.org/4.5.0/dc/de2/classcv_1_1FlannBasedMatcher.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::FlannBasedMatcher</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> and <a href="https://docs.opencv.org/4.5.0/db/d18/classcv_1_1flann_1_1GenericIndex.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::flann::GenericIndex</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">match using <em>two Nearest Neighbour</em> the extracted descriptors with the given model descriptors</li>
<li class="nx-my-2">After the matches filtering we have to subtract the 2D and 3D correspondences from the found scene keypoints and our 3D model using the obtained <em>DMatches</em> vector</li>
</ul>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Compute <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">R</code> and <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">t</code> using <a href="https://docs.opencv.org/4.5.0/d9/d0c/group__calib3d.html#ga50620f0e26e02caa2e9adc07b5fbf24e" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::solvePnPRansac</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">PnP algorithm in order to estimate the camera pose</li>
<li class="nx-my-2"><a href="https://docs.opencv.org/4.5.0/d9/d0c/group__calib3d.html#ga50620f0e26e02caa2e9adc07b5fbf24e" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::solvePnPRansac</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> instead of <a href="https://docs.opencv.org/4.5.0/d9/d0c/group__calib3d.html#ga549c2075fac14829ff4a58bc931c033d" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><strong>cv::solvePnP</strong><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> because after the matching not all the found correspondences are correct (outliers)</li>
<li class="nx-my-2">Ransac is an outlier detection method that fits linear models to several random samplings of the data and returning the model that has the best fit to a subset of the data.
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Select a random subset of the data</li>
<li class="nx-my-2">A model is fitted to the set of hypothetical inliers</li>
<li class="nx-my-2">All other data are then tested against the fitted model.</li>
<li class="nx-my-2">The estimated model is reasonably good if sufficiently many points have been classified as part of the consensus set</li>
<li class="nx-my-2">Repeat</li>
</ol>
</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-27 at 10.46.16.png" loading="lazy" width="1346" height="732" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 160&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAABlBMVEX8+/z19fUjcAquAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAEUlEQVR4nGNgwAoYwQQEMAAAAFQACSZCJ48AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-27_at_10.46.16.8be7a9a1.png"/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://docs.opencv.org/4.5.0/dc/d2c/tutorial_real_time_pose.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://docs.opencv.org/4.5.0/dc/d2c/tutorial_real_time_pose.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Finally, a KalmanFilter is applied in order to reject bad poses.</p>
</li>
</ol>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Pose estimation using Caffe<a href="#pose-estimation-using-caffe" id="pose-estimation-using-caffe" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Load Caffe pose estimation module</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">protoFile </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;pose/mpi/pose_deploy_linevec_faster_4_stages.prototxt&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">weightsFile </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;pose/mpi/pose_iter_160000.caffemodel&quot;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">net </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">dnn</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">readNetFromCaffe</span><span style="color:var(--shiki-token-punctuation)">(protoFile, weightsFile)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Load input img into the model by converting into blob</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">inpBlob </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">dnn</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">blobFromImage</span><span style="color:var(--shiki-token-punctuation)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">	frame, </span><span style="color:var(--shiki-token-constant)">1.0</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-token-punctuation)"> </span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">, (inWidth, inHeight), (</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">), swapRB</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)">False</span><span style="color:var(--shiki-token-punctuation)">, crop</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)">False</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">net</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">setInput</span><span style="color:var(--shiki-token-punctuation)">(inpBlob)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Make prediction and parse keypoint</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">matrix_output </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> net</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">forward</span><span style="color:var(--shiki-token-punctuation)">()</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">The first dimension is the image ID (in case forward on multiple images)</li>
<li class="nx-my-2">The second dimension indicates the index of a keypoint. 18 keypoint confidence Maps + 1 background + 19*2 Part Affinity Maps</li>
<li class="nx-my-2">The third dimension is the height of the output map.</li>
<li class="nx-my-2">The fourth dimension is the width of the output map.</li>
</ol>
</li>
</ul>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">H </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> out</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">W </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> out</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)"># Empty list to store the detected keypoints</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">points </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> []</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> i </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">range</span><span style="color:var(--shiki-token-punctuation)">(output.shape[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">]):</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># confidence map of corresponding body&#x27;s part.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    probMap </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> output</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> i</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-punctuation)">:,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-punctuation)">:]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># Find global maxima of the probMap.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    minVal</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> prob</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> minLoc</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> point </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">minMaxLoc</span><span style="color:var(--shiki-token-punctuation)">(probMap)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># Scale the point to fit on the original image</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    x </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (frameWidth </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)"> point</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">]</span><span style="color:var(--shiki-color-text)">) </span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)"> W</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    y </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (frameHeight </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)"> point</span><span style="color:var(--shiki-token-punctuation)">[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">]</span><span style="color:var(--shiki-color-text)">) </span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)"> H</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> prob </span><span style="color:var(--shiki-token-keyword)">&gt;</span><span style="color:var(--shiki-color-text)"> threshold</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">circle</span><span style="color:var(--shiki-token-punctuation)">(frame, (</span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(x), </span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(y)), </span><span style="color:var(--shiki-token-constant)">15</span><span style="color:var(--shiki-token-punctuation)">, (</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">), thickness</span><span style="color:var(--shiki-token-keyword)">=-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">, lineType</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">cv.FILLED)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">putText</span><span style="color:var(--shiki-token-punctuation)">(frame, </span><span style="color:var(--shiki-token-string-expression)">&quot;</span><span style="color:var(--shiki-token-constant)">{}</span><span style="color:var(--shiki-token-string-expression)">&quot;</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">format</span><span style="color:var(--shiki-token-punctuation)">(i), (</span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(x), </span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(y)), cv2.FONT_HERSHEY_SIMPLEX, </span><span style="color:var(--shiki-token-constant)">1.4</span><span style="color:var(--shiki-token-punctuation)">, (</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">, </span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">), </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">, lineType</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-punctuation)">cv2.LINE_AA)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        points</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">((</span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(x), </span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(y)))</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">else</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				points</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-constant)">None</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-27 at 09.50.41.png" loading="lazy" width="692" height="1042" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 200 320&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAICAMAAAAGL8UJAAAAP1BMVEWxuqqOm4lTZXGKgHHc4tuWpZGns6VSZ1u6wbOqsKJud2dvfm6vurNQX1DP1MivtK7CsJo0RDeZqKM5U0VSa4Gba5SrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAL0lEQVR4nAXBhQEAIAzAsA7bcP3/VhLaSS1Q1ZeI6tsdLa5fojipgDcYYVkCmzl/ILgBRExVsp4AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-27_at_09.50.41.1a287740.png"/></p>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Pose estimation using MediaPipe<a href="#pose-estimation-using-mediapipe" id="pose-estimation-using-mediapipe" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="python" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="python" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> mediapipe </span><span style="color:var(--shiki-token-keyword)">as</span><span style="color:var(--shiki-color-text)"> mp</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-color-text)"> mediapipe</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">solutions</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">pose </span><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> Pose</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-color-text)"> mediapipe</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">solutions</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">drawing_utils </span><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-color-text)"> draw_landmarks</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">pose </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">Pose</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">cap </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">VideoCapture</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;a.mp4&#x27;</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">pTime </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">while</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">True</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	success</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> img </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cap</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">read</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	h</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> w</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> c </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> img</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">shape</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">	imgRGB </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">cvtColor</span><span style="color:var(--shiki-token-punctuation)">(img, cv2.COLOR_BGR2RGB)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	results </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> pose</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">process</span><span style="color:var(--shiki-token-punctuation)">(imgRGB)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(results.pose_landmarks)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> results</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-color-text)">pose_landmarks</span><span style="color:var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-function)">draw_landmarks</span><span style="color:var(--shiki-token-punctuation)">(img, results.pose_landmarks, mpPose.POSE_CONNECTIONS)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> idx</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> lm </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">enumerate</span><span style="color:var(--shiki-token-punctuation)">(results.pose_landmarks.landmark):</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-function)">print</span><span style="color:var(--shiki-token-punctuation)">(idx, lm)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">			cx</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> cy </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(lm.x</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)">w),</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(lm.y</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-punctuation)">h)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">circle</span><span style="color:var(--shiki-token-punctuation)">(img, (cx, cy), </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-token-punctuation)">, (</span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">), cv2.FILLED)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">			cTime </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> time</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">time</span><span style="color:var(--shiki-token-punctuation)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			fps </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)">(cTime</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)">pTime)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			pTime </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> cTime</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">			cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">putText</span><span style="color:var(--shiki-token-punctuation)">(img, </span><span style="color:var(--shiki-token-constant)">str</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-constant)">int</span><span style="color:var(--shiki-token-punctuation)">(fps)), (</span><span style="color:var(--shiki-token-constant)">50</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">50</span><span style="color:var(--shiki-token-punctuation)">), cv2.FONT_HERSHEY_SIMPLEX,</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-token-punctuation)">,(</span><span style="color:var(--shiki-token-constant)">255</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-punctuation)">), </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-token-punctuation)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			cv2</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">imshow</span><span style="color:var(--shiki-token-punctuation)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Image&quot;</span><span style="color:var(--shiki-token-punctuation)">, img)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><img alt="Screen Shot 2021-10-27 at 10.06.36.png" loading="lazy" width="1222" height="736" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 200&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAAJ1BMVEW7u7zc3NyenZ7V1NS0tbWWlpWhoaXDw8KOkpTNzdOVmpypqK5vfYFy6qTMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAKklEQVR4nAXBhwEAMAzDINlZXf/fW+DCkCSnu10ulu9bdsHEYZOEtCXFBxBEAKwYySYgAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/Screen_Shot_2021-10-27_at_10.06.36.d64239d7.png"/></p><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400 print:nx-hidden"><a title="3. 2d features framework" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/opencv-tutorial/2d-features-framework"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>3. 2d features framework</a><a title="5. Video Analysis" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/opencv-tutorial/video-analysis">5. Video Analysis<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/opencv-tutorial/camera-calibration-and-3d-reconstruction","query":{},"buildId":"_hxuzv8OXSuUBok_Sbmau","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>